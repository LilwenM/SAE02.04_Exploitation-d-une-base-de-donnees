set schema 'parcoursup2';

-- Insertion _academie

insert into _academie(academie_nom)
select distinct academie_nom
from import_data;


-- Insertion _region

insert into _region(region_nom)
select distinct region_nom
from import_data;


-- Insertion _departement

insert into _departement(departement_code, departement_nom)
select distinct departement_code, departement_nom
from import_data;


-- Insertion _commune

insert into _commune(commune_nom, departement_nom)
select distinct commune_nom, departement_nom
from import_data


-- Insertion _etablissement

insert into _etablissement(etablissement_code_uai, etablissement_nom, etablissement_statut)
select distinct etablissement_code_uai, etablissement_nom, etablissement_statut
from import_data


-- Insertion _filiere

insert into _filiere(filiere_id, filiere_libelle, filiere_libelle_tres_abrege, filiere_abrege, filiere_libelle_detaille_bis)
select distinct filiere_id, filiere_libelle, filiere_libelle_tres_abrege, filiere_abrege, filiere_libelle_detaille_bis
from import_data;


-- Insertion _formation

insert into _formation(cod_aff_form, filiere_libelle_detaille, coordonnees_gps, list_com, concours_communs_banque_epreuve, url_formation, tri, filiere_id, academie_nom, etablissement_code_uai)
select i.cod_aff_form, f.filiere_libelle_detaille, i.coordonnees_gps, i.list_com, i.concours_communs_banque_epreuve, i.url_formation, i.tri, i.filiere_id, i.academie_nom, i.etablissement_code_uai
from import_data i natural join _filiere f; 


-- Insertion _session

insert into _session(session_annee)
select distinct session_anne
from import_data;


-- Insertion _mention_bac

insert into _mention_bac(libelle_mention)
values ('Sans information'), 
values ('Sans mention'), 
values ('Assez bien'); 
values ('Bien');
values ('Très bien');
values ('Très bien avec félicitations du jury');



-- Insertion _type_bac

insert into _type_bac(type_bac)
values ('Bac général'), 
values ('Bac technologique'), 
values ('Bac professionnel'), 
values ('Autres'); 


-- Insertion _regroupement 

insert into _regroupement(libelle_regroupement) 
select distinct regroupement_1
from import_data
where regroupement_1 is not null
union 
select distinct regroupement_2
from import_data
where regroupement_2 is not null
select distinct regroupement_3
from import_data
where regroupement_3 is not null; 



-- Insertion table association

-- Insertion _admission_generalites

insert into _admissions_generalites(cod_aff_form, session_annee, selectivite, capacite, effectif_total_candidats, effectif_total_candidates)
select distinct cod_aff_form, session_annee, selectivite, capacite, effectif_total_candidats, effectif_total_candidates
from import_data;

insert into _rang_dernier_appele_selon_regroupement(cod_aff_form, session_annee, libelle_regroupement, rang_dernier_appele)
select distinct i.cod_aff_form, i.session_annee, r.libelle_regroupement, i.rang_dernier_appele_groupe1
from import_data i natural join _regroupement r
union
select distinct i.cod_aff_form, i.session_annee, r.libelle_regroupement, i.rang_dernier_appele_groupe2
from import_data i natural join _regroupement r
union
select distinct i.cod_aff_form, i.session_annee, r.libelle_regroupement, i.rang_dernier_appele_groupe3
from import_data i natural join _regroupement r;


-- Insertion _admissions_selon_type_neo_bac

insert into _admissions_selon_type_neo_bac(cod_aff_form, session_annee, type_bac, effectif_candidat_neo_bac_classes)
select distinct cod_aff_form, session_annee, 'Bac professionnel', effectif_candidat_neo_bac_classes_type_pro from import_data
union
select distinct cod_aff_form, session_annee, 'Bac technologique',effectif_candidat_neo_bac_classes_type_techno from import_data
union
select distinct cod_aff_form, session_annee, 'Bac général',effectif_candidat_neo_bac_classes_type_general from import_data
union
select distinct cod_aff_form, session_annee, 'Autres',effectif_candidat_classes_type_autres from import_data;


-- Insertion _effectif_selon_mention

insert into _effectif_selon_mention(cod_aff_form, session_annee, libelle_mention, effectif_admis_neo_bac_selon_mention)
select distinct cod_aff_form, session_annee, 'Sans information',effectif_admis_neo_bac_selon_mention_type_mention_sans_info from import_data
union
select distinct cod_aff_form, session_annee, 'Sans mention',effectif_admis_neo_bac_selon_mention_type_mention_sans_mention from import_data
union
select distinct cod_aff_form, session_annee, 'Assez bien',effectif_admis_neo_bac_selon_mention_type_mention_assez_bien from import_data
union
select distinct cod_aff_form, session_annee, 'Bien',effectif_admis_neo_bac_selon_mention_type_mention_bien from import_data
union
select distinct cod_aff_form, session_annee, 'Très bien',effectif_admis_neo_bac_selon_mention_type_mention_tres_bien from import_data
union
select distinct cod_aff_form, session_annee, 'Très bien avec félicitations du jury', effectif_admis_neo_bac_selon_mention_type_mention_tres_bien_fel from import_data;


-- Insertion _rang_dernier_appele_selon_regroupement

insert into _rang_dernier_appele_selon_regroupement(cod_aff_form, session_annee, libelle_regroupement, rang_dernier_appele)
select distinct i.cod_aff_form, i.session_annee, i.regroupement_1, i.rang_dernier_appele_groupe1
from import_data i
where i.rang_dernier_appele_groupe1 is not null and i.regroupement_1 is not null
union
select distinct i.cod_aff_form, i.session_annee, i.regroupement_2, i.rang_dernier_appele_groupe2
from import_data i
where i.rang_dernier_appele_groupe2 is not null and i.regroupement_2 is not null
union
select distinct i.cod_aff_form, i.session_annee, i.regroupement_3, i.rang_dernier_appele_groupe3
from import_data i
where i.rang_dernier_appele_groupe3 is not null and i.regroupement_3 is not null;